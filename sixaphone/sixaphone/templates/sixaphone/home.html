{% extends "sixaphone/base.html" %}

{% block content %}

    <div id="play-all" class="player-box">
        <span class="tp-button"><span class="button button-xl button-play">
            <a href="#" class="disabled">â–¶ &nbsp;Play all</a>
        </span></span>
    </div>

    <script type="text/javascript">
        var xids = [ {% for audio, event in audio_events %}
            '{{ event.xid }}'
            {% if forloop.last %}{% else %},{% endif %}
        {% endfor %} ];
        $('#play-all a').click(function () {
            return false;
        });
        soundManager.onready(function (status) {
            if (!status.success)
                return;

            $('#play-all a').click(function () {
                $.each(xids, function (i, val) {
                    if (i < xids.length - 1) {
                        $('#player-' + val).one('finished', function () {
                            soundManager.load('event-' + xids[i + 1]);
                            $('#player-' + xids[i + 1]).delay(1000).queue(function () {
                                $('.statusbar .position').css({width: 0});
                                soundManager.stopAll();
                                soundManager.play('event-' + xids[i + 1]);
                                $(this).dequeue();
                            });
                        });
                    }
                });

                $('.statusbar .position').css({width: 0});
                soundManager.stopAll();
                soundManager.play('event-' + xids[0]);

                return false;
            }).removeClass('disabled');
        });
    </script>

    {% for audio, event in audio_events %}
        {% with event.object as entry %}
            {% include "sixaphone/player.html" %}
        {% endwith %}
    {% endfor %}

{% endblock %}
